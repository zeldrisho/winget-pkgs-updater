packageIdentifier: Microsoft.PowerShell
# Path structure: manifests/{first-letter}/{publisher}/{package}
# Example: https://github.com/microsoft/winget-pkgs/tree/master/manifests/m/Microsoft/PowerShell
# Raw manifest reference: https://raw.githubusercontent.com/microsoft/winget-pkgs/master/manifests/m/Microsoft/PowerShell/7.5.3.0/Microsoft.PowerShell.installer.yaml
manifestPath: manifests/m/Microsoft/PowerShell

# GitHub-based checkver
# Use script to append .0 to version (GitHub: 7.5.4 -> WinGet: 7.5.4.0)
checkver:
  type: script
  script: |
    # Get latest release from GitHub API
    $response = Invoke-RestMethod -Uri "https://api.github.com/repos/PowerShell/PowerShell/releases/latest"
    if ($response.tag_name) {
      # Tag format: v7.5.4 (with 'v' prefix)
      # Remove 'v' and append '.0' for WinGet format
      $version = $response.tag_name.TrimStart('v') + '.0'
      $releaseNotes = $response.body
      $releaseNotesUrl = $response.html_url
      
      # Output format: version|releaseNotesUrl|releaseNotes
      Write-Output "$version|$releaseNotesUrl|$releaseNotes"
    }
  regex: "(?P<version>[\\d\\.]+)\\|(?P<releaseNotesUrl>[^\\|]+)\\|(?P<releaseNotes>.*)"

updateMetadata:
  - ReleaseDate
  - ReleaseNotes
  - ReleaseNotesUrl

# PowerShell installer URLs from GitHub releases
# Format: https://github.com/PowerShell/PowerShell/releases/download/v{versionShort}/PowerShell-{versionShort}-win-{arch}.msi
# Note: URLs use 3-digit version (7.5.4) but manifest uses 4-digit (7.5.4.0)
# {versionShort} removes trailing .0 from version
installerUrlTemplate:
  x64: "https://github.com/PowerShell/PowerShell/releases/download/v{versionShort}/PowerShell-{versionShort}-win-x64.msi"
  x86: "https://github.com/PowerShell/PowerShell/releases/download/v{versionShort}/PowerShell-{versionShort}-win-x86.msi"
  arm64: "https://github.com/PowerShell/PowerShell/releases/download/v{versionShort}/PowerShell-{versionShort}-win-arm64.msi"
